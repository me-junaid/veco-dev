---
import { Image } from "astro:assets";

// ===================================================================================
// DATA STRUCTURE - This is the only part you need to edit.
// ===================================================================================
import vexologo from "../assets/images/vexologo.png"; // Your logo
import bookletImage from "../assets/images/Frames/Canvas Frame-01.jpg";
import waxSealImage from "../assets/images/Frames/Canvas Frame-01.jpg";
import stickerImage from "../assets/images/Frames/Canvas Frame-01.jpg";
import businessCardImage from "../assets/images/Frames/Canvas Frame-01.jpg";
import letterheadImage from "../assets/images/Frames/Canvas Frame-01.jpg";
import envelopeImage from "../assets/images/Frames/Canvas Frame-01.jpg";

// This array drives the entire page content.
const categories = [
  {
    name: "Print & Marketing",
    slug: "print-marketing",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
  {
    name: "Fashion & Textile",
    slug: "fashion-textile",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
  {
    name: "Office & Store Branding",
    slug: "office-branding",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
  {
    name: "Signages",
    slug: "signages",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
  {
    name: "Flags",
    slug: "flags",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
  {
    name: "Backdrops & Exhibition",
    slug: "backdrops-exhibition",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
  {
    name: "Corporate Gifts & Bags",
    slug: "corporate-gifts",
    subCategories: [
      {
        name: "Most Popular",
        products: [
          { name: "Booklets", image: bookletImage, href: "/products/booklets" },
          { name: "Wax Seal", image: waxSealImage, href: "/products/wax-seal" },
          { name: "Stickers", image: stickerImage, href: "/products/stickers" },
        ],
      },
      {
        name: "Stationery & Corporate Identity",
        products: [
          {
            name: "Business Cards",
            image: businessCardImage,
            href: "/products/business-cards",
          },
          {
            name: "Letterheads",
            image: letterheadImage,
            href: "/products/letterheads",
          },
          {
            name: "Envelopes",
            image: envelopeImage,
            href: "/products/envelopes",
          },
        ],
      },
    ],
  },
];
---

<style is:global>
  /* This is the key to the app-style layout. It prevents the main page from scrolling. */
  body, html {
    height: 100%;
    overflow: hidden;
    /* Use a standard font for a clean look */
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  }
  /* Enables smooth scrolling within the main content area */
  #main-content {
    scroll-behavior: smooth;
  }
  /* Style for the active sidebar link, matching the screenshot */
  .sidebar-link.is-active {
    background-color: #f3f4f6; /* light grey */
    color: #111827; /* dark text */
    font-weight: 600;
  }
</style>

<!-- This container takes up the entire screen and controls the layout -->
<div class="h-full w-full flex flex-col bg-white">
  
  <!-- Header: Fixed at the top -->
  <header class="flex-shrink-0 flex items-center justify-between px-4 h-16 border-b border-gray-200">
    <a href="/" aria-label="Close">
      <svg class="w-6 h-6 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
    </a>
    <a href="/" aria-label="Homepage">
      <Image src={vexologo} alt="Deluxe Printing Logo" class="h-12 w-auto" />
    </a>
    <button type="button" aria-label="Search">
      <svg class="w-6 h-6 text-gray-800" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
    </button>
  </header>

  <!-- Main Content Area (Sidebar + Scrollable Grid) -->
  <div class="flex-grow flex flex-row overflow-hidden">
    
    <!-- Left Column: Fixed Sidebar -->
    <aside class="flex-shrink-0 w-[140px] bg-white border-r border-gray-200 p-2 overflow-y-auto">
      <nav>
        <ul class="space-y-1">
          <li>
            <a href="/" class="sidebar-link is-active flex items-center gap-2 w-full text-left px-3 py-2.5 rounded-lg text-sm font-medium">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
              Home
            </a>
          </li>
          {categories.map(category => (
            <li>
              <a href={`#${category.slug}`} data-slug={category.slug} class="sidebar-link block w-full text-left px-3 py-2.5 rounded-lg text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                {category.name}
              </a>
            </li>
          ))}
          <li class="pt-2">
            <a href="/projects" class="block w-full text-center px-3 py-2.5 rounded-lg text-white text-sm font-semibold bg-[#D9534F] hover:bg-[#C9302C] transition-colors">
              Our Projects
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Right Column: The ONLY Scrollable Area -->
    <main id="main-content" class="flex-grow overflow-y-auto">
      <div class="p-4 sm:p-5 space-y-10">
        {categories.map(category => (
          <section id={category.slug} class="scroll-mt-4">
            <h2 class="text-lg font-bold text-gray-800 flex items-center">
              {category.name} <span class="text-orange-500 ml-2 text-xs">‚ñ∂</span>
            </h2>
            <div class="mt-4 space-y-8">
              {category.subCategories.map(subCat => (
                <div>
                  <h3 class="font-semibold text-gray-700">{subCat.name}</h3>
                  <div class="grid grid-cols-3 gap-4 mt-3">
                    {subCat.products.map(product => (
                      <a href={product.href} class="group block text-center">
                        <div class="aspect-square w-full bg-gray-100 rounded-lg overflow-hidden border border-gray-200">
                          <Image src={product.image} alt={product.name} class="w-full h-full object-cover group-hover:scale-105 transition-transform" />
                        </div>
                        <p class="mt-2 text-xs font-medium text-gray-800">{product.name}</p>
                      </a>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </section>
        ))}
        <!-- Add padding to the bottom to ensure the last items can scroll above the sticky footer -->
        <div class="h-24"></div>
      </div>
    </main>
  </div>

  <!-- Sticky Bottom Bar: Fixed at the bottom -->
  <footer class="flex-shrink-0 bg-white border-t border-gray-200 p-3 shadow-top z-40">
    <div class="flex justify-between items-center">
      <div class="text-xs">
        <a href="tel:+97142725202" class="flex items-center gap-1.5 font-semibold text-gray-800">üìû +91 9876543210</a>
        <a href="mailto:print@dlxprint.com" class="flex items-center gap-1.5 text-gray-600">‚úâÔ∏è print@vexo.com</a>
      </div>
      <div class="flex items-center gap-2">
        <a href="/inquiry" class="bg-[#D9534F] text-white font-bold px-3 py-2 rounded-full text-xs">Quick Inquiry</a>
        <a href="https://wa.me/97142725202" aria-label="Chat on WhatsApp" class="text-green-500">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 4.315 1.731 6.086l.001.004 4.971 4.971z"/></svg>
        </a>
      </div>
    </div>
  </footer>
</div>

<script>
  function initializeSidebarObserver() {
    const mainContent = document.getElementById('main-content');
    const sidebarLinks = document.querySelectorAll('.sidebar-link');
    const sections = document.querySelectorAll('#main-content section');

    if (!mainContent || !sidebarLinks.length || !sections.length) return;

    // This observer watches for sections scrolling within the main content area
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const slug = entry.target.id;
          
          sidebarLinks.forEach(link => {
            const isHomeLink = !link.getAttribute('data-slug');
            const isTargetLink = link.getAttribute('data-slug') === slug;
            // Activate if it's the target link, deactivate if it's not (unless it's the Home link, which we ignore)
            if (!isHomeLink) {
              link.classList.toggle('is-active', isTargetLink);
            }
          });
          
          // If a category is intersecting, the Home link cannot be active
          const homeLink = document.querySelector('.sidebar-link:not([data-slug])');
          if (homeLink) {
            homeLink.classList.remove('is-active');
          }
        }
      });
    }, {
      root: mainContent, // This is CRITICAL: it sets the scrollable area to observe
      rootMargin: "-40% 0px -40% 0px", // Activates when a section is in the middle of the main area
    });

    sections.forEach(section => observer.observe(section));

    // Special handling for the "Home" link. It becomes active only when the top is visible.
    const homeObserver = new IntersectionObserver(([entry]) => {
      if (entry.isIntersecting) {
        sidebarLinks.forEach(link => link.classList.remove('is-active'));
        const homeLinkEl = document.querySelector('.sidebar-link:not([data-slug])');
        if (homeLinkEl) {
          homeLinkEl.classList.add('is-active');
        }
      }
    }, { root: mainContent, threshold: 0.9 });

    // We observe the first section's title to represent the "top" of the content
    const firstSection = sections[0];
    if (firstSection) {
        homeObserver.observe(firstSection);
    }
  }

  document.addEventListener('DOMContentLoaded', initializeSidebarObserver);
</script>