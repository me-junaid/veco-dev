---
import { Image } from "astro:assets";
import logo from "../assets/images/vexologo.png";

// KEY CHANGE 1: Define navigation links in one place (DRY principle).
const navLinks = [
  { href: "/products", text: "Products" },
  { href: "/why-us", text: "Why Us?" },
  { href: "/quote", text: "Get a Quote?" },
];
---

<style>
  body.menu-open {
    overflow: hidden;
  }
  #mobile-menu {
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
  }
  #mobile-menu.is-hidden {
    opacity: 0;
    transform: translateY(-1rem);
    pointer-events: none;
  }
  .icon {
    transition: opacity 0.2s ease, transform 0.2s ease;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .is-hidden-icon {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.7);
    pointer-events: none;
  }
</style>

<!-- The header remains fixed at the top -->
<header class="h-20 shadow-md flex items-center px-4 sm:px-8 justify-between bg-[#093832] fixed top-0 left-0 right-0 z-50">
  <div class="flex items-center">
    <a href="/" aria-label="Vexo Home Page">
      <Image src={logo} alt="Vexo Logo" class="h-16 w-16"/>
    </a>
  </div>

  <!-- Desktop navigation, now rendered from the navLinks array -->
  <nav class="hidden md:flex">
    <ul class="flex items-center gap-10 text-white">
      {navLinks.map(link => (
        <li>
          <a href={link.href} class="text-sm font-semibold hover:text-gray-300 transition-colors">
            {link.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>

  <!-- Mobile menu toggle button -->
  <div class="md:hidden">
    <button
      id="menu-toggle-button"
      type="button"
      class="text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white rounded-md p-1 relative h-8 w-8"
      aria-controls="mobile-menu"
      aria-expanded="false"
    >
      <span class="sr-only">Open main menu</span>
      <svg id="icon-menu" class="icon h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
      <svg id="icon-close" class="icon h-6 w-6 is-hidden-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>
  </div>
</header>

<!-- Mobile menu panel -->
<div id="mobile-menu" class="is-hidden md:hidden bg-[#093832]/95 backdrop-blur-sm fixed top-20 left-0 right-0 bottom-0 z-40 overflow-y-auto">
  <nav class="mt-6">
    <ul class="flex flex-col items-center gap-4 text-white">
      <!-- Mobile navigation, also rendered from the navLinks array -->
      {navLinks.map(link => (
        <li>
          <a href={link.href} class="block py-3 text-lg font-semibold hover:text-gray-300 transition-colors">
            {link.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
</div>

<!-- KEY CHANGE 2: Add a placeholder to prevent the fixed header from overlapping page content -->
<div class="h-20"></div>

<script>
  // KEY CHANGE 3: More robust and readable script with auto-close functionality
  function initializeMobileMenu() {
    const toggleButton = document.getElementById("menu-toggle-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const iconMenu = document.getElementById("icon-menu");
    const iconClose = document.getElementById("icon-close");

    if (!toggleButton || !mobileMenu || !iconMenu || !iconClose) return;

    const closeMenu = () => {
      mobileMenu.classList.add("is-hidden");
      iconMenu.classList.remove("is-hidden-icon");
      iconClose.classList.add("is-hidden-icon");
      document.body.classList.remove("menu-open");
      toggleButton.setAttribute("aria-expanded", "false");
    };

    const openMenu = () => {
      mobileMenu.classList.remove("is-hidden");
      iconMenu.classList.add("is-hidden-icon");
      iconClose.classList.remove("is-hidden-icon");
      document.body.classList.add("menu-open");
      toggleButton.setAttribute("aria-expanded", "true");
    };

    toggleButton.addEventListener("click", () => {
      const isExpanded = toggleButton.getAttribute("aria-expanded") === "true";
      if (isExpanded) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Add event listener to the menu itself to close it when a link is clicked
    mobileMenu.addEventListener("click", (event) => {
      // Check if the clicked element is an anchor tag
      const target = event.target instanceof HTMLElement ? event.target : null;
      if (target && target.tagName === 'A') {
        closeMenu();
      }
    });
  }

  document.addEventListener("DOMContentLoaded", initializeMobileMenu);
</script>