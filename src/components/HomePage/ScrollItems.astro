---
import { Image } from "astro:assets";
import { categoryData } from "../../data/Items.js"; // Adjust the import path as needed
---

<style>
  /* Styling for the active category card */
  .category-card.is-active {
    border-color: #bf9b42;
    transform: scale(1.05);
  }

  /* Base styles for the scroll buttons */
  .scroll-button {
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
    transform: translateY(-50%); /* Vertical centering */
  }

  /* A class to hide a button when at the start/end of the scroll */
  .scroll-button.is-hidden {
    opacity: 0;
    pointer-events: none;
    transform: translateY(-50%) scale(0.8);
  }
</style>

<!-- Wrapper div to position the buttons relative to the scroller -->
<div id="scroll-wrapper" class="relative group">
  <!-- Left Scroll Button -->
  <!-- KEY CHANGE 1: Buttons are now visible on all screen sizes by default -->
  <button
    id="scroll-left-button"
    class="scroll-button absolute top-1/2 left-3 md:left-10 z-10 bg-white/80 backdrop-blur-sm rounded-full p-2 shadow-md hover:bg-white focus:outline-none border-2 border-[#bf9b42]"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 sm:h-6 sm:w-6 text-gray-700"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"
      ></path>
    </svg>
  </button>

  <!-- Horizontally scrolling category cards -->
  <div
    id="scrolling-container"
    class="scrolling-container flex gap-4 sm:gap-7 overflow-x-auto no-scrollbar pb-4 px-4 sm:px-18 pt-6 scroll-smooth"
  >
    {
      categoryData.map((category, index) => (
        <div
          data-category-id={category.id}
          class:list={[
            "category-card min-w-[120px] md:min-w-[150px] border-2 md:border-4 hover:border-[#d3ffd0] rounded-2xl border-transparent transition duration-300 cursor-pointer py-5 px-1 md:px-2",
            { "is-active": index === 0 },
          ]}
        >
          <div class="flex justify-center items-center h-[100px] relative overflow-hidden pointer-events-none transform  transition-transform duration-300">
            <Image
              src={category.imageUrl}
              alt={category.title}
              class="max-h-full max-w-full"
            />
          </div>
          <p class="font-semibold text-center pointer-events-none mt-2">
            {category.title}
          </p>
        </div>
      ))
    }
  </div>

  <!-- Right Scroll Button -->
  <button
    id="scroll-right-button"
    class="scroll-button absolute top-1/2 right-3 md:right-10 z-10 bg-white/80 backdrop-blur-sm rounded-full p-2 shadow-md hover:bg-white focus:outline-none border-2 border-[#bf9b42]"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 sm:h-6 sm:w-6 text-gray-700"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"
      ></path>
    </svg>
  </button>
</div>

<!-- KEY CHANGE 2: The JavaScript is updated to handle visibility more robustly -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const wrapper = document.getElementById("scroll-wrapper");
    if (!wrapper) return;

    const container = document.getElementById("scrolling-container");
    const leftButton = document.getElementById("scroll-left-button");
    const rightButton = document.getElementById("scroll-right-button");
    const scrollAmount = 300; // The distance to scroll on each click

    const updateButtonState = () => {
      if (!container || !leftButton || !rightButton) return;

      const isScrollable = container.scrollWidth > container.clientWidth;

      // If the container isn't scrollable, hide both buttons
      if (!isScrollable) {
        leftButton.classList.add("is-hidden");
        rightButton.classList.add("is-hidden");
        return;
      }

      const maxScrollLeft = container.scrollWidth - container.clientWidth;

      // Toggle left button visibility
      if (container.scrollLeft <= 0) {
        leftButton.classList.add("is-hidden");
      } else {
        leftButton.classList.remove("is-hidden");
      }

      // Toggle right button visibility
      if (container.scrollLeft >= maxScrollLeft - 1) {
        // -1 for precision
        rightButton.classList.add("is-hidden");
      } else {
        rightButton.classList.remove("is-hidden");
      }
    };

    if (leftButton) {
      leftButton.addEventListener("click", () => {
        if (container) {
          container.scrollBy({ left: -scrollAmount, behavior: "smooth" });
        }
      });
    }

    if (rightButton) {
      rightButton.addEventListener("click", () => {
        if (container) {
          container.scrollBy({ left: scrollAmount, behavior: "smooth" });
        }
      });
    }
    // Update buttons when the user scrolls manually
    if (container) {
      container.addEventListener("scroll", updateButtonState, {
        passive: true,
      });
    }

    // Initial check when the page loads
    // Use a small delay to ensure layout is fully calculated
    setTimeout(updateButtonState, 100);

    // Also check on window resize
    window.addEventListener("resize", updateButtonState);
  });
</script>
